# Reproducible Research: Peer Assessment 1

### set knitr code chunk global options:
```{r setoptions,echo=TRUE}
opts_chunks$set(echo=TRUE)
library(ggplot2)
```

## Loading and preprocessing the data
```{r loading}
activity <- read.csv(file = unz("activity.zip", "activity.csv"))
## combine the date and interval into a datetime column
activity$interval<-sprintf("%04d",activity$interval) # fix to 4 characters 
activity$datetime<-paste(activity$date,activity$interval)
activity$datetime<-strptime(activity$datetime,"%Y-%m-%d %H%M")
#View(activity)
#str(activity)
```

## What is mean total number of steps taken per day?
### Make a histogram of the total number of steps taken each day
```{r histogram}
daily.totals<-tapply(activity$steps,activity$date,sum)
dt.hist <- qplot(daily.totals,binwidth=3000)
dt.hist
```

### Calculate and report the mean and median total number of steps taken per day
```{r averages}
dt.mean <- mean(daily.totals,na.rm=T)
dt.med <- median(daily.totals,na.rm=T)
dt.mean
dt.med
```

## What is the average daily activity pattern?

### Make a time series plot of the 5-minute interval and the average number of steps taken, averaged across all days
```{r time-series-plot}
intervals<-data.frame(tapply(activity$steps,as.factor(activity$interval),mean,na.rm=T))
names(intervals)<-"avg.steps"
View(intervals)
## make annoying row names into a useful column
intervals <- cbind(interval = as.numeric(rownames(intervals)), intervals)
qplot(interval, avg.steps, data= intervals, geom = "line")
```

### Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?
```{r max_interval}
max_interval <- which(intervals == max(intervals$avg.steps), arr.ind = TRUE)
max_interval
```


## Imputing missing values

### Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)
```{r count_NAs}
count_NAs <- sum(is.na(activity))
count_NAs
```

### Devise a strategy for filling in all of the missing values in the dataset.
```{r fill_NAs}
library(plyr)
impute <- function(x, fun) {
  missing <- is.na(x)
  replace(x, missing, fun(x[!missing]))
}
ddply(df, ~ group, transform, traits = impute(traits, mean))

interval.index <- function(x) intervals$avg.steps[[
                        activity$interval[x]]]

act<-activity
act$steps<-ifelse(is.na(activity$steps),
                       interval.index(activity$steps),activity$steps)
act$steps<-ifelse(is.na(activity$steps),
                  impute(activity$steps,mean),activity$steps)
View(act)
activity$steps[1]
um<-intervals$avg.steps[[activity$interval[3]]]
str(um)
um

missing <- is.na(activity$steps)
head(missing)
```




## Are there differences in activity patterns between weekdays and weekends?
